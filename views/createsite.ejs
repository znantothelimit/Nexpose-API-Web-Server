<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ”§ Nexpose ì‚¬ì´íŠ¸ ìƒì„±</title>
  <link rel="stylesheet" href="/createsite.css">
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <h1>ğŸ”§ Nexpose ì‚¬ì´íŠ¸ ìƒì„±</h1>

  <form id="siteForm" action="/createsite" method="POST">
    <label for="name">ì‚¬ì´íŠ¸ ì´ë¦„</label>
    <input type="text" name="name" id="name" required>

    <label for="target">ëŒ€ìƒ IP / í˜¸ìŠ¤íŠ¸ <span style="font-weight: normal; color: #888;">(ì‰¼í‘œë¡œ êµ¬ë¶„)</span></label>
    <input type="text" name="target" id="target" required placeholder="ì˜ˆ: 192.168.0.1, 192.168.0.10-192.168.0.20, 192.168.0.0/24">

    <label for="excluded">âŒ ì œì™¸ ìì‚° (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
    <input type="text" name="excluded" id="excluded" placeholder="ì˜ˆ: 192.168.0.1, 192.168.0.10-192.168.0.20, 192.168.0.0/24">

    <label for="engineId">âš™ï¸ ìŠ¤ìº” ì—”ì§„ ì„ íƒ</label>
    <select name="engineId" id="engineId" required>
      <option value="">-- ìŠ¤ìº” ì—”ì§„ ì„ íƒ --</option>
      <% engines.forEach(engine => { %>
        <option value="<%= engine.id %>"><%= engine.name %> (ID: <%= engine.id %>)</option>
      <% }); %>
    </select>

    <label for="scanTemplateId">ğŸ“ ìŠ¤ìº” í…œí”Œë¦¿ ì„ íƒ</label>
    <select name="scanTemplateId" id="scanTemplateId" required>
      <option value="">-- ìŠ¤ìº” í…œí”Œë¦¿ ì„ íƒ --</option>
      <% templates.forEach(template => { %>
        <option value="<%= template.id %>"><%= template.name %> (<%= template.id %>)</option>
      <% }); %>
    </select>

    <!-- ìˆ¨ê²¨ì§„ í•„ë“œ -->
    <input type="hidden" name="service" id="hiddenService">
    <input type="hidden" name="username" id="hiddenUsername">
    <input type="hidden" name="password" id="hiddenPassword">
    <input type="hidden" name="domain" id="hiddenDomain">
    <input type="hidden" name="permissionElevation" id="hiddenElevation">
    <input type="hidden" name="permissionElevationUsername" id="hiddenElevationUsername">
    <input type="hidden" name="permissionElevationPassword" id="hiddenElevationPassword">
    <input type="hidden" name="hostRestriction" id="hiddenHostRestriction">
    <input type="hidden" name="portRestriction" id="hiddenPortRestriction">

    <button type="button" onclick="openModal()">â• ìê²©ì¦ëª… ì¶”ê°€</button>
    <br><br>
    <button type="submit">ì‚¬ì´íŠ¸ ìƒì„±</button>
  </form>

  <a href="/">â¬…ï¸ ëŒì•„ê°€ê¸°</a>

  <!-- ìê²©ì¦ëª… ëª¨ë‹¬ -->
  <div id="credentialModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h3>ğŸ” ìê²©ì¦ëª… ì…ë ¥</h3>

      <label>ì„œë¹„ìŠ¤</label>
      <select id="modalService">
        <option value="ssh">SSH</option>
        <option value="ftp">FTP</option>
        <option value="http">HTTP</option>
        <option value="cifs">CIFS</option>
      </select>

      <label>ì‚¬ìš©ì ì´ë¦„</label>
      <input type="text" id="modalUsername">

      <label>ë¹„ë°€ë²ˆí˜¸</label>
      <input type="password" id="modalPassword">

      <label>ë„ë©”ì¸ (ì„ íƒ)</label>
      <input type="text" id="modalDomain">

      <hr>
      <h4>ğŸ›¡ ê¶Œí•œ ìƒìŠ¹ (ì„ íƒ)</h4>
      <label>ë°©ì‹</label>
      <select id="modalElevation">
        <option value="none">ì—†ìŒ</option>
        <option value="sudo">sudo</option>
        <option value="sudosu">sudosu</option>
        <option value="su">su</option>
        <option value="pbrun">pbrun</option>
        <option value="privileged-exec">privileged-exec</option>
      </select>

      <label>ìƒìŠ¹ ê³„ì • ì´ë¦„</label>
      <input type="text" id="modalElevationUsername">

      <label>ìƒìŠ¹ ê³„ì • ë¹„ë°€ë²ˆí˜¸</label>
      <input type="password" id="modalElevationPassword">

      <hr>
      <h4 id="restrictionToggle" onclick="toggleRestriction()" style="cursor: pointer; color: #3498db;">
        â• ì œí•œ ì‚¬í•­
      </h4>

      <div id="restrictionFields" style="display: none;">
        <label>IP ì£¼ì†Œ ë˜ëŠ” í˜¸ìŠ¤íŠ¸ ì´ë¦„</label>
        <input type="text" id="modalHostRestriction" placeholder="ì˜ˆ: 192.168.0.1">

        <label>í¬íŠ¸</label>
        <input type="number" id="modalPortRestriction" placeholder="ì˜ˆ: 22">
      </div>

      <hr>
      <button type="button" onclick="applyCredential()">âœ… ìê²©ì¦ëª… ì¶”ê°€</button>
    </div>
  </div>

  <script>
    function openModal() {
      document.getElementById('credentialModal').style.display = 'block';
    }

    function closeModal() {
      document.getElementById('credentialModal').style.display = 'none';
    }

    function toggleRestriction() {
      const box = document.getElementById('restrictionFields');
      const toggleText = document.getElementById('restrictionToggle');

      const isVisible = box.style.display === 'block';
      box.style.display = isVisible ? 'none' : 'block';
      toggleText.innerHTML = isVisible ? 'â• ì œí•œ ì‚¬í•­' : 'â– ì œí•œ ì‚¬í•­';
    }

    function applyCredential() {
      document.getElementById('hiddenService').value = document.getElementById('modalService').value;
      document.getElementById('hiddenUsername').value = document.getElementById('modalUsername').value;
      document.getElementById('hiddenPassword').value = document.getElementById('modalPassword').value;
      document.getElementById('hiddenDomain').value = document.getElementById('modalDomain').value;
      document.getElementById('hiddenElevation').value = document.getElementById('modalElevation').value;
      document.getElementById('hiddenElevationUsername').value = document.getElementById('modalElevationUsername').value;
      document.getElementById('hiddenElevationPassword').value = document.getElementById('modalElevationPassword').value;
      document.getElementById('hiddenHostRestriction').value = document.getElementById('modalHostRestriction').value;
      document.getElementById('hiddenPortRestriction').value = document.getElementById('modalPortRestriction').value;

      closeModal();
      alert('ìê²©ì¦ëª…ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
  </script>
</body>
</html>
